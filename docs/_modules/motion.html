<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>motion &mdash; Physics 360 PiBOT 0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Physics 360 PiBOT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">lib</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Physics 360 PiBOT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">motion</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for motion</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">This module contains the Motion class that allows for user control of</span>
<span class="sd">the PiBOT&#39;s motion. The path planning and motor control required to</span>
<span class="sd">enable smooth and accurate motion are fairly complex and involve</span>
<span class="sd">calculating the desired wheel rotations for each time step, measuring</span>
<span class="sd">the actual rotation with encoders on each motor, and computing the</span>
<span class="sd">commanded motor effort with a closed-loop PID algorithm. Those tasks</span>
<span class="sd">are encapsulated in the Control class, which does not have any</span>
<span class="sd">user-accessible attributes and works behind the scenes on the second</span>
<span class="sd">core of the RP2040 microcontroller to maintain a fast (approximately</span>
<span class="sd">10 ms) time step. The user-accessible methods in the Motion class must</span>
<span class="sd">have access to the private attributes of the Control class to check the</span>
<span class="sd">current status of the PiBOT and request new motion or other actions like</span>
<span class="sd">a pause or resume in motion. When an instance of Motion is created, an</span>
<span class="sd">instance of Control is passed into it as an argument to provide access</span>
<span class="sd">to these private attributes.</span>

<span class="sd">The Control class acts as an event-driven finite-state machine that runs</span>
<span class="sd">in an infinite polling loop on the second core using the _thread module.</span>
<span class="sd">Control attempts to maintain a uniform time step of 10 ms and checks for</span>
<span class="sd">events that require a change of motion state. An event takes place when</span>
<span class="sd">a user calls one of the methods of the Motion class from the main core</span>
<span class="sd">of the RP2040, which in turn sets some parameters in the second core</span>
<span class="sd">where the control loop takes action at the appropriate time by updating</span>
<span class="sd">the motion state and calling motion control methods to handle the path</span>
<span class="sd">planning and control. The methods of the Motion class simply trigger the</span>
<span class="sd">correct response from the control loop and provide the user-requested</span>
<span class="sd">parameters for the motion (e.g., speed, distance, angle, etc.).</span>

<span class="sd">As a result of this multi-threaded, event-driven approach to controlling</span>
<span class="sd">the PiBOT motion, it is possible to send many motion commands to the</span>
<span class="sd">control loop in quick succession. The commands will generate a rapid</span>
<span class="sd">handling of events that is out of sync with how a user might imagine the</span>
<span class="sd">motion commands would work. For example, if on one line of a script, the</span>
<span class="sd">user requests forward motion at 10 cm/s for a distance of 10 cm, that</span>
<span class="sd">command is received by the control loop and started immediately. The</span>
<span class="sd">control loop enters a new state of linear motion and is ready to handle</span>
<span class="sd">new events. Meanwhile, the PiBOT has just started accelerating and won&#39;t</span>
<span class="sd">complete the requested move for about another second. If on the next</span>
<span class="sd">line of the script, the user requests a turn of 90 degrees, the event is</span>
<span class="sd">immediately handled by the control loop and the state is updated to turn</span>
<span class="sd">motion. From the user perspective, the forward motion was skipped</span>
<span class="sd">entirely and all they see is a turn move. This behavior could be</span>
<span class="sd">perplexing at first. The essential thing to understand with this</span>
<span class="sd">multi-threading approach to motion control is that user motion calls are</span>
<span class="sd">not blocking, meaning that they don&#39;t tie up and pause the script until</span>
<span class="sd">the motion is completed. The advantage to this approach is that once</span>
<span class="sd">motion is called, it is managed outside of the main core, leaving the</span>
<span class="sd">user free to take many other actions like checking sensors while the</span>
<span class="sd">PiBOT goes merrily on its way.</span>

<span class="sd">Important</span>
<span class="sd">---------</span>

<span class="sd">Because motion calls are not blocking and can override moves already in</span>
<span class="sd">progress, some users might be tempted to use kludgy time delays to wait</span>
<span class="sd">for each move to finish. That approach can work, but it requires</span>
<span class="sd">calculating the require time for each move and eliminates the advantage</span>
<span class="sd">of non-blocking moves that allow users to run other commands while moves</span>
<span class="sd">are underway. Instead, there is a special argument in many of the Motion</span>
<span class="sd">methods called &#39;queue&#39; that allows motion calls to be run in a sequence.</span>
<span class="sd">When one move finishes, the control loop checks for any moves waiting in</span>
<span class="sd">the queue and automatically starts the next one in line. The examples in</span>
<span class="sd">the following section about the Motion class demonstrate how to use the</span>
<span class="sd">queue.</span>

<span class="sd">Note</span>
<span class="sd">----</span>

<span class="sd">By default, when a Motion method is called, the control loop stops any</span>
<span class="sd">active motion and starts the new request immediately. There is an</span>
<span class="sd">argument in many of the Motion methods called &#39;protect&#39; that keeps a</span>
<span class="sd">move from being interrupted by any subsequent motion calls. When using</span>
<span class="sd">the &#39;queue&#39; argument, the &#39;protect&#39; argument must also be used to ensure</span>
<span class="sd">that the queued moves are allowed to finish before the next one starts.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">constants</span> <span class="k">as</span> <span class="nn">cnst</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>


<div class="viewcode-block" id="Motion"><a class="viewcode-back" href="../motion.html#motion.Motion">[docs]</a><span class="k">class</span> <span class="nc">Motion</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates user motion commands for PiBOT.</span>

<span class="sd">    ...</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    control : object</span>
<span class="sd">        Instance of the Control class.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    When creating an instance of the PiBOT class, an instance of the</span>
<span class="sd">    Control class is passed to this Motion class to gain access to the</span>
<span class="sd">    control attributes.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates motion control attributes.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span> <span class="o">=</span> <span class="n">control</span>

<div class="viewcode-block" id="Motion.pause"><a class="viewcode-back" href="../motion.html#motion.Motion.pause">[docs]</a>    <span class="k">def</span> <span class="nf">pause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Smoothly pauses all motion by ramping down velocity.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Calling .pause() halts any motion command, including protected</span>
<span class="sd">        and queued motion. High speed moves take longer to ramp down.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_pause</span><span class="p">()</span></div>

<div class="viewcode-block" id="Motion.resume"><a class="viewcode-back" href="../motion.html#motion.Motion.resume">[docs]</a>    <span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Smoothly resumes motion after a pause.</span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>

<span class="sd">        Import time and create an instance of PiBOT.</span>

<span class="sd">        &gt;&gt;&gt; import time</span>
<span class="sd">        &gt;&gt;&gt; from pibot import PiBOT</span>
<span class="sd">        &gt;&gt;&gt; robot = PiBOT()</span>
<span class="sd">     </span>
<span class="sd">        Move 10 cm at 5 cm/s and protect the motion from interruptions</span>
<span class="sd">        by other motion commands. Pause after 1 second and then resume</span>
<span class="sd">        the previous motion after 1 more second. Notice that the</span>
<span class="sd">        .pause() method always halts motion, even protected moves.</span>

<span class="sd">        &gt;&gt;&gt; robot.move.forward(5, 10, protect=True)</span>
<span class="sd">        &gt;&gt;&gt; time.sleep(1)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.pause()</span>
<span class="sd">        &gt;&gt;&gt; time.sleep(1)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.resume()</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_resume</span><span class="p">()</span></div>

<div class="viewcode-block" id="Motion.forward"><a class="viewcode-back" href="../motion.html#motion.Motion.forward">[docs]</a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">protect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Commands a forward (or reverse) linear path with constant speed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed : int or float</span>
<span class="sd">            The desired speed in cm/s. Range from 5 to 30 cm/s.</span>
<span class="sd">        distance : int or float, default=0</span>
<span class="sd">            The desired distance to travel in cm. The default of zero</span>
<span class="sd">            commands continuous motion.</span>
<span class="sd">        protect : bool, default=False</span>
<span class="sd">            Prevents interruption by another motion command.</span>
<span class="sd">        queue : bool, default=False</span>
<span class="sd">            Adds motion call to a queue for a sequence.</span>
<span class="sd">        reverse : bool, default=False</span>
<span class="sd">            Reverses the direction.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Uses a linear velocity profile to approximate constant</span>
<span class="sd">        acceleration by ramping velocity up and down at the start and</span>
<span class="sd">        stop, which produces smoother motion with less wheel slippage.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Import time and create an instance of PiBOT.</span>

<span class="sd">        &gt;&gt;&gt; import time</span>
<span class="sd">        &gt;&gt;&gt; from pibot import PiBOT</span>
<span class="sd">        &gt;&gt;&gt; robot = PiBOT()</span>

<span class="sd">        Command continuous motion at 10 cm/s and pause after 2 seconds.</span>

<span class="sd">        &gt;&gt;&gt; robot.move.forward(10)</span>
<span class="sd">        &gt;&gt;&gt; time.sleep(2)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.pause()</span>

<span class="sd">        Move 10 cm at 15 cm/s and protect the motion from interruptions</span>
<span class="sd">        by other motion commands.</span>

<span class="sd">        &gt;&gt;&gt; robot.move.forward(15, 10, protect=True)</span>

<span class="sd">        Store moves in the queue to run a sequence. protect must be set</span>
<span class="sd">        to True when using a queue to prevent later queue entries from</span>
<span class="sd">        interrupting the earlier ones.</span>

<span class="sd">        &gt;&gt;&gt; robot.move.forward(5, 5, protect=True, queue=True)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.reverse(5, 5, protect=True, queue=True)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.forward(20, 10, protect=True, queue=True)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.reverse(20, 10, protect=True, queue=True)</span>
<span class="sd">        </span>
<span class="sd">        An unprotected move can be interrupted at any time with a new</span>
<span class="sd">        motion call. The control loop handles the smooth transitions.</span>
<span class="sd">        The following example calls forward motion and then reverse</span>
<span class="sd">        without stopping first.</span>

<span class="sd">        &gt;&gt;&gt; robot.move.forward(10)</span>
<span class="sd">        &gt;&gt;&gt; time.sleep(1)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.reverse(20, 10)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check for valid arguments</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_arguments</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span>
                                          <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span> <span class="n">protect</span><span class="o">=</span><span class="n">protect</span><span class="p">,</span>
                                          <span class="n">queue</span><span class="o">=</span><span class="n">queue</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: invalid argument to .forward() method&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="c1"># do nothing if motion is protected and the command is not queued</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_protect</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">queue</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># change signs for reverse direction</span>
        <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="n">speed</span> <span class="o">=</span> <span class="o">-</span><span class="n">speed</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="o">-</span><span class="n">distance</span>
        <span class="c1"># store motion in queue if requested</span>
        <span class="k">if</span> <span class="n">queue</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_queue</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">protect</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span>
                                             <span class="n">distance</span><span class="p">])</span>
            <span class="k">return</span>
        <span class="c1"># store command in _motion_curr attribute</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_curr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">protect</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">distance</span><span class="p">]</span>
            <span class="c1"># clear out old queue when calling new non-sequence move</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_queue</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="Motion.reverse"><a class="viewcode-back" href="../motion.html#motion.Motion.reverse">[docs]</a>    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">protect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Commands a linear reverse path with constant speed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed : int or float</span>
<span class="sd">            The desired speed in cm/s. Range from 5 to 30 cm/s.</span>
<span class="sd">        distance : int or float, default=0</span>
<span class="sd">            The desired distance to travel in cm. The default of zero</span>
<span class="sd">            commands continuous motion.</span>
<span class="sd">        protect : bool, default=False</span>
<span class="sd">            Prevents interruption by another motion command.</span>
<span class="sd">        queue : bool, default=False</span>
<span class="sd">            Adds motion call to a queue for a sequence.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Reverse linear motion is generated using the .forward() method</span>
<span class="sd">        with the reverse parameter set to True.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">protect</span><span class="o">=</span><span class="n">protect</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="n">queue</span><span class="p">,</span>
                     <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Motion.turn"><a class="viewcode-back" href="../motion.html#motion.Motion.turn">[docs]</a>    <span class="k">def</span> <span class="nf">turn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">protect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Commands a turn in place.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        angle : int or float, maximum +/- 720</span>
<span class="sd">            The desired rotation angle to turn in place in degrees.</span>
<span class="sd">            Positive for left turn, negative for right turn.</span>
<span class="sd">        protect : bool, default=False</span>
<span class="sd">            Prevents interruption by another motion command.</span>
<span class="sd">        queue : bool, default=False</span>
<span class="sd">            Adds motion call to a queue for a sequence.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Uses a ramped angular velocity profile to approximate constant</span>
<span class="sd">        acceleration by ramping velocity up and down at the start and</span>
<span class="sd">        stop, which produces smoother motion with less wheel slippage.</span>
<span class="sd">        The angular velocity and acceleration are set by the constants</span>
<span class="sd">        TURN_SPD and TURN_ACC and should not be changed.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Import time and create an instance of PiBOT.</span>

<span class="sd">        &gt;&gt;&gt; import time</span>
<span class="sd">        &gt;&gt;&gt; from pibot import PiBOT</span>
<span class="sd">        &gt;&gt;&gt; robot = PiBOT()</span>

<span class="sd">        Turn left and then right back to starting position.</span>

<span class="sd">        &gt;&gt;&gt; robot.move.turn(-45)</span>
<span class="sd">        &gt;&gt;&gt; time.sleep(1)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.turn(45)</span>

<span class="sd">        Move 10 cm at 15 cm/s, turn around and return to starting point</span>
<span class="sd">        using the queue to create a sequence.</span>

<span class="sd">        &gt;&gt;&gt; robot.move.forward(15, 10, protect=True, queue=True)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.turn(180, protect=True, queue=True)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.forward(15, 10, protect=True, queue=True)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.turn(-180, protect=True, queue=True)</span>
<span class="sd">        </span>
<span class="sd">        If turn motion is called while another unprotected move is in</span>
<span class="sd">        progress, the turn temporarily interrupts the current motion and</span>
<span class="sd">        then resumes it after completing the turn as shown below.</span>

<span class="sd">        &gt;&gt;&gt; robot.move.forward(5, 20)</span>
<span class="sd">        &gt;&gt;&gt; time.sleep(2)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.turn(180)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check for valid arguments</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_arguments</span><span class="p">(</span><span class="s1">&#39;turn&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span> <span class="n">protect</span><span class="o">=</span><span class="n">protect</span><span class="p">,</span>
                                          <span class="n">queue</span><span class="o">=</span><span class="n">queue</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: invalid argument to .turn() method&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="c1"># do nothing if motion is protected and the command is not queued</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_protect</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">queue</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># calculate desired robot turn angle (radians)</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span><span class="o">*</span><span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
        <span class="c1"># set the turn speed based on direction</span>
        <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ang_velo</span> <span class="o">=</span> <span class="n">cnst</span><span class="o">.</span><span class="n">TURN_SPD</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ang_velo</span> <span class="o">=</span> <span class="o">-</span><span class="n">cnst</span><span class="o">.</span><span class="n">TURN_SPD</span>
        <span class="c1"># store motion in queue if requested</span>
        <span class="k">if</span> <span class="n">queue</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_resume</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ready&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_queue</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;turn&#39;</span><span class="p">,</span> <span class="n">protect</span><span class="p">,</span> <span class="n">ang_velo</span><span class="p">,</span> <span class="n">angle</span><span class="p">])</span>
            <span class="k">return</span>
        <span class="c1"># store command in _motion_curr attribute</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_curr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;turn&#39;</span><span class="p">,</span> <span class="n">protect</span><span class="p">,</span> <span class="n">ang_velo</span><span class="p">,</span> <span class="n">angle</span><span class="p">]</span>
            <span class="c1"># clear out old queue when calling new non-sequence move</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_queue</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="c1"># if interrupting, store current motion to resume after the turn</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_resume</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ready&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_state</span> <span class="o">!=</span> <span class="s1">&#39;stop&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_resume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_prev</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>
            
<div class="viewcode-block" id="Motion.arc_forward"><a class="viewcode-back" href="../motion.html#motion.Motion.arc_forward">[docs]</a>    <span class="k">def</span> <span class="nf">arc_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">arc_length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">arc_angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">sense</span><span class="o">=</span><span class="s1">&#39;counterclockwise&#39;</span><span class="p">,</span> <span class="n">protect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Commands a forward (or reverse) arc path with constant speed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed : int or float</span>
<span class="sd">            The desired speed in cm/s. Range from 5 to 30 cm/s.</span>
<span class="sd">        radius : int or float</span>
<span class="sd">            The desired arc radius in cm. Must be positive. Minimum</span>
<span class="sd">            radius is 0.5 cm. Use .turn() method to spin in place.</span>
<span class="sd">        arc_length : int or float, default=0</span>
<span class="sd">            The desired arc length to travel in cm. The default of zero</span>
<span class="sd">            commands a continuous arc or allows arc angle to be defined.</span>
<span class="sd">            Must be positive.</span>
<span class="sd">        arc_angle : int or float, default=0, maximum 360</span>
<span class="sd">            The desired arc angle to travel in degrees. The default of</span>
<span class="sd">            zero commands a continuous arc or allows arc length to be</span>
<span class="sd">            defined. Must be positive.</span>
<span class="sd">        sense : {&#39;counterclockwise&#39;, &#39;clockwise&#39;}</span>
<span class="sd">            The rotation sense for robot to rotate.</span>
<span class="sd">        protect : bool, default=False</span>
<span class="sd">            Prevents interruption by another motion command.</span>
<span class="sd">        queue : bool, default=False</span>
<span class="sd">            Adds motion call to a queue for a sequence.</span>
<span class="sd">        reverse : bool, default=False</span>
<span class="sd">            Reverses the direction</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Uses a linear velocity profile to approximate constant</span>
<span class="sd">        acceleration by ramping velocity up and down at the start and</span>
<span class="sd">        stop, which produces smoother motion with less wheel slippage.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Import time and create an instance of PiBOT.</span>

<span class="sd">        &gt;&gt;&gt; import time</span>
<span class="sd">        &gt;&gt;&gt; from pibot import PiBOT</span>
<span class="sd">        &gt;&gt;&gt; robot = PiBOT()</span>

<span class="sd">        Command continuous arc with a 15 cm radius at a speed of 10 cm/s</span>
<span class="sd">        and pause after 1 second.</span>

<span class="sd">        &gt;&gt;&gt; robot.move.arc_forward(10, 15)</span>
<span class="sd">        &gt;&gt;&gt; time.sleep(1)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.pause()</span>

<span class="sd">        Move an arc length of 10 cm with a 20 cm radius at a speed of</span>
<span class="sd">        5 cm/s with a clockwise sense.</span>

<span class="sd">        &gt;&gt;&gt; robot.move.arc_forward(5, 20, arc_length=10, sense=&#39;clockwise&#39;)</span>

<span class="sd">        Store moves in the queue to run a sequence. protect must be set</span>
<span class="sd">        to True when using a queue to prevent later queue entries from</span>
<span class="sd">        interrupting the earlier ones.</span>

<span class="sd">        &gt;&gt;&gt; robot.move.arc_forward(10, 5, arc_angle=45, protect=True, queue=True)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.arc_reverse(10, 5, arc_angle=45, protect=True, queue=True)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.arc_forward(15, 25, arc_angle=30, sense=&#39;clockwise&#39;, protect=True, queue=True)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.arc_reverse(15, 25, arc_angle=30, sense=&#39;clockwise&#39;, protect=True, queue=True)</span>

<span class="sd">        An unprotected move can be interrupted at any time with a new</span>
<span class="sd">        motion call. The control loop handles the smooth transitions.</span>
<span class="sd">        The following example calls arc motion and then reverse motion</span>
<span class="sd">        without stopping first.</span>

<span class="sd">        &gt;&gt;&gt; robot.move.arc_forward(10, 15, sense=&#39;clockwise&#39;)</span>
<span class="sd">        &gt;&gt;&gt; time.sleep(1)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.reverse(20, 10)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check for valid arguments</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_arguments</span><span class="p">(</span><span class="s1">&#39;arc&#39;</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                                          <span class="n">arc_length</span><span class="o">=</span><span class="n">arc_length</span><span class="p">,</span>
                                          <span class="n">arc_angle</span><span class="o">=</span><span class="n">arc_angle</span><span class="p">,</span> <span class="n">sense</span><span class="o">=</span><span class="n">sense</span><span class="p">,</span>
                                          <span class="n">protect</span><span class="o">=</span><span class="n">protect</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="n">queue</span><span class="p">,</span>
                                          <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: invalid argument to .arc_forward() method&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="c1"># do nothing if motion is protected and the command is not queued</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_protect</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">queue</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># limit velocity as needed to avoid exceeding SPD_MAX on outer wheel</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">((</span><span class="n">cnst</span><span class="o">.</span><span class="n">WHEEL_SPAN</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">radius</span><span class="p">))</span> <span class="o">*</span> <span class="n">speed</span> <span class="o">&gt;</span> <span class="n">cnst</span><span class="o">.</span><span class="n">SPD_MAX</span><span class="p">:</span>
            <span class="n">speed</span> <span class="o">=</span> <span class="n">cnst</span><span class="o">.</span><span class="n">SPD_MAX</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">((</span><span class="n">cnst</span><span class="o">.</span><span class="n">WHEEL_SPAN</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">radius</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">speed</span><span class="o">/</span><span class="n">radius</span> <span class="o">&gt;</span> <span class="n">cnst</span><span class="o">.</span><span class="n">TURN_SPD</span><span class="p">:</span>
                <span class="n">speed</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">cnst</span><span class="o">.</span><span class="n">TURN_SPD</span>
        <span class="c1"># calculate arc length from desired turn angle</span>
        <span class="k">if</span> <span class="n">arc_angle</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">arc_length</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">arc_angle</span><span class="o">*</span><span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
        <span class="c1"># change signs for reverse direction</span>
        <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="n">speed</span> <span class="o">=</span> <span class="o">-</span><span class="n">speed</span>
            <span class="n">arc_length</span> <span class="o">=</span> <span class="o">-</span><span class="n">arc_length</span>
        <span class="c1"># calculate the wheel differential velocities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_wheel_diff</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">sense</span><span class="p">)</span>
        <span class="c1"># stored motion in queue if requested</span>
        <span class="k">if</span> <span class="n">queue</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_queue</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;arc&#39;</span><span class="p">,</span> <span class="n">protect</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span>
                                             <span class="n">arc_length</span><span class="p">,</span> <span class="n">sense</span><span class="p">])</span>
            <span class="k">return</span>
        <span class="c1"># store command in motion_curr attribute</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_curr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;arc&#39;</span><span class="p">,</span> <span class="n">protect</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span>
                                       <span class="n">arc_length</span><span class="p">,</span> <span class="n">sense</span><span class="p">]</span>
            <span class="c1"># clear out old queue if calling new non-sequence moves</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_queue</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="Motion.arc_reverse"><a class="viewcode-back" href="../motion.html#motion.Motion.arc_reverse">[docs]</a>    <span class="k">def</span> <span class="nf">arc_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">arc_length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">arc_angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">sense</span><span class="o">=</span><span class="s1">&#39;counterclockwise&#39;</span><span class="p">,</span> <span class="n">protect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Commands a reverse arc path with constant speed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed : int or float</span>
<span class="sd">            The desired speed in cm/s. Range from 5 to 30 cm/s.</span>
<span class="sd">        radius : int or float</span>
<span class="sd">            The desired arc radius in cm. Must be positive. Minimum</span>
<span class="sd">            radius is 0.5 cm. Use .turn() method to spin in place.</span>
<span class="sd">        arc_length : int or float, default=0</span>
<span class="sd">            The desired arc length to travel in cm. The default of zero</span>
<span class="sd">            commands a continuous arc or allows arc angle to be defined.</span>
<span class="sd">            Must be positive.</span>
<span class="sd">        arc_angle : int or float, default=0, maximum 360</span>
<span class="sd">            The desired arc angle to travel in degrees. The default of</span>
<span class="sd">            zero commands a continuous arc or allows arc length to be</span>
<span class="sd">            defined. Must be positive.</span>
<span class="sd">        sense : {&#39;counterclockwise&#39;, &#39;clockwise&#39;}</span>
<span class="sd">            The rotation sense for robot to rotate.</span>
<span class="sd">        protect : bool, default=False</span>
<span class="sd">            Prevents interruption by another motion command.</span>
<span class="sd">        queue : bool, default=False</span>
<span class="sd">            Adds motion call to a queue for a sequence.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        A reverse arc path is generated using the .arc_forward() method</span>
<span class="sd">        with the reverse parameter set to True.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">arc_forward</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">arc_length</span><span class="p">,</span> <span class="n">arc_angle</span><span class="p">,</span> <span class="n">sense</span><span class="p">,</span>
                         <span class="n">protect</span><span class="o">=</span><span class="n">protect</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="n">queue</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Motion.steer_left"><a class="viewcode-back" href="../motion.html#motion.Motion.steer_left">[docs]</a>    <span class="k">def</span> <span class="nf">steer_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">arc_angle</span><span class="o">=</span><span class="mi">360</span><span class="p">,</span> <span class="n">protect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Steers left in an arc path at a discrete angle if already in motion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        radius : int or float</span>
<span class="sd">            The desired arc radius in cm. Must be positive. Minimum</span>
<span class="sd">            radius is 0.5 cm. Use .turn() method to spin in place.</span>
<span class="sd">        arc_angle : int or float, default=360, maximum 360</span>
<span class="sd">            The desired arc angle in degrees. The default of 360 (also</span>
<span class="sd">            the maximum) commands a full circle. Must be positive.</span>
<span class="sd">        protect : bool, default=False</span>
<span class="sd">            Prevents interruption by another motion command.</span>
<span class="sd">        right : bool, default=False</span>
<span class="sd">            Commands a right turn instead of left (changes sense).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Uses the .arc_forward() method to create a discrete arc path</span>
<span class="sd">        for smooth steering without stopping. This method only works</span>
<span class="sd">        when the robot is already moving in either a linear or arc path.</span>
<span class="sd">        After turning through the specified angle, the robot resumes its</span>
<span class="sd">        previous motion path.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>

<span class="sd">        Import time and create an instance of PiBOT.</span>

<span class="sd">        &gt;&gt;&gt; import time</span>
<span class="sd">        &gt;&gt;&gt; from pibot import PiBOT</span>
<span class="sd">        &gt;&gt;&gt; robot = PiBOT()</span>

<span class="sd">        Start by commanding forward motion at 5 cm/s. Then steer left</span>
<span class="sd">        30 degrees and back to the right 210 degrees to loop around.</span>

<span class="sd">        &gt;&gt;&gt; robot.move.forward(5)</span>
<span class="sd">        &gt;&gt;&gt; time.sleep(1)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.steer_left(25, 30)</span>
<span class="sd">        &gt;&gt;&gt; time.sleep(4)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.steer_right(5, 210)</span>
<span class="sd">        &gt;&gt;&gt; time.sleep(6)</span>
<span class="sd">        &gt;&gt;&gt; robot.move.pause()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check for valid arguments</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_arguments</span><span class="p">(</span><span class="s1">&#39;steer&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                                          <span class="n">arc_angle</span><span class="o">=</span><span class="n">arc_angle</span><span class="p">,</span> <span class="n">protect</span><span class="o">=</span><span class="n">protect</span><span class="p">,</span>
                                          <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: invalid argument to .steer_left() method&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="c1"># do nothing if robot is not in linear or arc motion or is ramping down</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_protect</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_state</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="s1">&#39;turn&#39;</span><span class="p">,</span> <span class="s1">&#39;steer&#39;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_velo_set</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="c1"># store previous motion to resume after steering</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_resume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_prev</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>        
        <span class="c1"># calculate desired robot turn angle (rad)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_velo_set</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">arc_length</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">arc_angle</span><span class="o">*</span><span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arc_length</span> <span class="o">=</span> <span class="o">-</span><span class="n">radius</span> <span class="o">*</span> <span class="n">arc_angle</span><span class="o">*</span><span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># set the arc radius and rotation sense for steering</span>
        <span class="k">if</span> <span class="n">right</span><span class="p">:</span>
            <span class="n">sense</span> <span class="o">=</span> <span class="s1">&#39;clockwise&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sense</span> <span class="o">=</span> <span class="s1">&#39;counterclockwise&#39;</span>
        <span class="c1"># store command in motion_curr attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_motion_curr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;steer&#39;</span><span class="p">,</span> <span class="n">protect</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctrl</span><span class="o">.</span><span class="n">_velo_set</span><span class="p">,</span>
                                   <span class="n">radius</span><span class="p">,</span> <span class="n">arc_length</span><span class="p">,</span> <span class="n">sense</span><span class="p">]</span></div>

<div class="viewcode-block" id="Motion.steer_right"><a class="viewcode-back" href="../motion.html#motion.Motion.steer_right">[docs]</a>    <span class="k">def</span> <span class="nf">steer_right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">arc_angle</span><span class="o">=</span><span class="mi">360</span><span class="p">,</span> <span class="n">protect</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Steers right in an arc path at a discrete angle if already in motion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        radius : int or float</span>
<span class="sd">            The desired arc radius in cm. Must be positive. Minimum</span>
<span class="sd">            radius is 0.5 cm. Use .turn() method to spin in place.</span>
<span class="sd">        arc_angle : int or float, default=360, maximum 360</span>
<span class="sd">            The desired arc angle in degrees. The default of 360 (also</span>
<span class="sd">            the maximum) commands a full circle. Must be positive.</span>
<span class="sd">        protect : bool, default=False</span>
<span class="sd">            Prevents interruption by another motion command.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Right steering motion is generated using the .steer_left()</span>
<span class="sd">        method with the right parameter set to True.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">steer_left</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">arc_angle</span><span class="p">,</span> <span class="n">protect</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_valid_arguments</span><span class="p">(</span><span class="n">motion_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arc_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arc_angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">sense</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">protect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks for valid arguments from user calls.</span>

<span class="sd">        Accepts all the parameters to .forward(), .reverse(), .turn(),</span>
<span class="sd">        .arc_forward(), .arc_reverse(), .steer_left(), and</span>
<span class="sd">        .steer_right() methods.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># general checks for most motion commands</span>
        <span class="k">if</span> <span class="n">motion_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;arc&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">speed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: speed must be set&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">speed</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: speed must be positive&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">distance</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">distance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: distance must be positive&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">speed</span> <span class="o">&gt;</span> <span class="n">cnst</span><span class="o">.</span><span class="n">SPD_MAX</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: maximum speed of robot is: </span><span class="si">%.2f</span><span class="s1"> cm/s&#39;</span> <span class="o">%</span><span class="n">cnst</span><span class="o">.</span><span class="n">SPD_MAX</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">speed</span> <span class="o">&lt;</span> <span class="n">cnst</span><span class="o">.</span><span class="n">SPD_MIN</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: minimum speed of robot is: </span><span class="si">%.2f</span><span class="s1"> cm/s&#39;</span> <span class="o">%</span><span class="n">cnst</span><span class="o">.</span><span class="n">SPD_MIN</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">motion_type</span> <span class="o">!=</span> <span class="s1">&#39;steer&#39;</span> <span class="ow">and</span> <span class="n">protect</span> <span class="o">!=</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">protect</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: protect must be a boolean value True or False&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">motion_type</span> <span class="o">!=</span> <span class="s1">&#39;steer&#39;</span> <span class="ow">and</span> <span class="n">queue</span> <span class="o">!=</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">queue</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: queue must be a boolean value True or False&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">distance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">queue</span> <span class="ow">and</span> <span class="n">distance</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: only discrete moves in queue, set a distance&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">motion_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;arc&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">reverse</span> <span class="o">!=</span> <span class="kc">True</span>
                                                   <span class="ow">and</span> <span class="n">reverse</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: reverse must be a boolean value True or False&#39;</span><span class="p">)</span>
        <span class="c1"># specific checks for turn motion</span>
        <span class="k">elif</span> <span class="n">motion_type</span> <span class="o">==</span> <span class="s1">&#39;turn&#39;</span> <span class="ow">and</span> <span class="n">angle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: angle must be set&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">angle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: angle value cannot be zero&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">angle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">720</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: maximum magnitude of angle is +/-720 degrees&#39;</span><span class="p">)</span>
        <span class="c1"># specific checks for arc motion</span>
        <span class="k">elif</span> <span class="n">motion_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;arc&#39;</span> <span class="ow">or</span> <span class="s1">&#39;steer&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">radius</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: radius must be set&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">radius</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: minimum radius is 0.5 cm. Use turn() method to spin&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">arc_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">arc_length</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: arc_length must be positive&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">arc_angle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="n">arc_angle</span> <span class="o">&gt;</span> <span class="mi">360</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: arc_angle must be positive and &lt;= 360 degrees&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">motion_type</span> <span class="o">==</span> <span class="s1">&#39;arc&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sense</span> <span class="o">!=</span> <span class="s1">&#39;clockwise&#39;</span>
                                       <span class="ow">and</span> <span class="n">sense</span> <span class="o">!=</span> <span class="s1">&#39;counterclockwise&#39;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: sense must be &#39;clockwise&#39; or &#39;counterclockwise&#39;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">motion_type</span> <span class="o">==</span> <span class="s1">&#39;arc&#39;</span> <span class="ow">and</span> <span class="n">arc_length</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">arc_angle</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: arc_length and arc_angle cannot both be set&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">queue</span> <span class="ow">and</span> <span class="n">arc_length</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">arc_angle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: set value of arc_length or arc_angle for queue&#39;</span><span class="p">)</span>
        <span class="c1"># specific check for steer motion</span>
        <span class="k">elif</span> <span class="n">motion_type</span> <span class="o">==</span> <span class="s1">&#39;steer&#39;</span> <span class="ow">and</span> <span class="n">right</span> <span class="o">!=</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">right</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: right must be a boolean value True or False&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if no invalid arguments are found, return True</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># if an invalid argument is found, return False</span>
        <span class="k">return</span> <span class="kc">False</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Turner Howard.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>